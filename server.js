var port = Number(process.env.PORT || 8080);

var parseurl = require('parseurl');
var express = require('express');
var app = express();

app.get('/', function(req, res) {
  res.send('Huemul image holder');
});

app.get('/*', function(req, res) {
  var args = parseurl(req).pathname.replace('/', '').split('x');
  var width = args[0];
  var height = args[1];
  var font_size = Math.round(Math.max(12, Math.min(Math.min(args[0], args[1]) * 0.75, 0.75 * Math.max(args[0], args[1]) / 12)))
  res.writeHead(200, {'Content-Type': 'image/svg+xml'});
  res.end('<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink= "http://www.w3.org/1999/xlink" width="' + width + '" height="' + height + '" viewBox="0 0 ' + width + ' ' + height + '" preserveAspectRatio="none"><rect width="' + width + '" height="' + height + '" fill="#000"/><image opacity=".4" xlink:href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAIAAAACACAYAAADDPmHLAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyRpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENTNiAoTWFjaW50b3NoKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDoxNDYwOEY3OUREQzAxMUU1QUU5OUNFNkZGRTMzN0U0MiIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDoxNDYwOEY3QUREQzAxMUU1QUU5OUNFNkZGRTMzN0U0MiI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjE0NjA4Rjc3RERDMDExRTVBRTk5Q0U2RkZFMzM3RTQyIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjE0NjA4Rjc4RERDMDExRTVBRTk5Q0U2RkZFMzM3RTQyIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+BHJWHAAADNtJREFUeNrsXWtsHNUV/mbG+/T6EcePOCEOISQhgAOBUAlKIVQC1WnSprSItoRHAUWiRY0qkh/UIuJH2qoKVWtUER4qaqRSpRQqFVq7tIUmbl1a7AiaQgKJQuIkdlzHibPZXdv7muk5OzP78jqx49eufT7p2LPj8czsvd/c+51zz72jGIYBweyFKkUgBBAIAQRCAIEQQCAEEAgBBEIAgRBAIAQQCAEEQgCBEEAgBBAIAQRCAIEQQDCzUCRFkBPLyH5BFiGLXeTYRWRPkf02x9+2k32J7JT12WWdcyNZrxAgf1FKdusYjl80wv4byOotS4dbugCBEEAgBBAIAQQiAqf3+99B5iGLWvv6/H7/za2trdA0DYqiXPAEwWAQq1evvmrx4sVXp4lBnmzR39HRUdXZ2Qmv15vYGY/Hoaoq7iB4PJ5DtKs8zTs4R7ZnykuAJ4bMYvORBYwstLe3G1Yljsp27Nhh5EJDQ0PO448dO5br8GPTUQbSBYgGEAgBBEIAgXgBMx0cf19KFrA+D0YikfLnn3/ecf78ebjdZnTW6S1D/8mP8LVr6enQAIV/EErpz/u7Dfy7Ux924j179mDevHno6emx9ihweHxYqHZiA13R5TPPocfIC9BUvPLLl1A89zJEh4KJ/QMDA/z/pZs2bXrC8kac1onKyD4ge32yCkWZRdPD28lWZ7twtbW1id/pqJ+v4O3vODFEVRGz6ntxpYKfvB3Dlt/HRn3Bl7/pwAM3aTjeb5axxwGE6d8/+7MIuvyZ5V5XVwd2GXOghWyttABTiAhV0qdnjMRvmwA61VdfaGzn6Q0YOHzawKnzZmW7qbTD8dQ5RQMIhAACIYBAvID8x5mQgWtrFXz3tiJ4nRc/nsXeFSQczw0aQoCZgHOD5ENWKbj1CnVUIo68PfSQ+AuEqZBVIUDBw0GufChiegdjKuA872RFA4gGEIz05Oppj4dixQJihrltg9sDTTEtu22IG+b/KEKAAnONqMZcVsmoempfhIM4UWTUKAdSNc08Xk9jAOeRcCRR15HXDJhNoeAVZHNg5uUzAvF4vGb//v0tkUjEy9k/jIrKaux7dy+2bHoAThdXrll7PQEDG+o1bP18EXqDqTKbX6bg560x7Hovnti2W4XzQ0DjnUW4/UoVfSEjSSImCesIJodmtTAeLYbTYS92H19BrYaKIsVkXVdXF+655x5/U1PTAZYhad9lCdnTZM9KCzB6HBym1DWta9WqVcM0/dm+FTjOwwNBuzpNcEjXoWUe66TPp+k4Vvuf9GY+TKFI5vFxqztYXafCoaZajLnFLnx4Koqtv+sYdtOHDx/mAaGbc3yfhdIFFBjsnuBsKJMo7FaeCU1PSyxewGzXO1IE4gZOJjyWeNHz8LtzD+8b70m44bb7eY8j5RkMxUzRN5qGnY9nr4GHi9nTsD2QQRaKiJt6IhSCLdh1ci1cLpeDDFnfgR9o9lMG84UAvyK725ZTeQbDKjDveE5yot/A/TdpuPcGLVHh6Sfnivxf4OIU8A8aqCpW8PojmYMM1T4Dfz7UCqWoFMUeI6khOIGlsbHx29u3b/9WVivOZHiD7Mv51AJgIp60fAULOJ8rdxxggBzOaBwZxMgF/j+VqrHKZwpFI+liqih2UFMSH0Io6xEKh8OOLNfQxphmHosXMAFBIx75C8dG/vtFvQPF7AaC4cz9HEsYiooIFBSwCBSMAtwF8NjDXNIB6V3AvFIFZR6lIAhwGdniNPXJ3+EMR7F6e3thqdWCAIeCjx4+iDrqj7NDwbVUIdH4xF+TvQhu6v/xqW7qAavOK4kQH50yCoIAm8m2DNu5eTNaWloK7olcUaPgj487E/16LGswiFW9MsEPZalbQbdfx2OvRqf8u0oXMEKTzJWfnhZuDwfn9diuEGBi3TvbMhT7TPNipKrFCxBMAuK6qeJLXBefCcRiLzCkFAQB7iS7imMUafu69u3bd01bWxvKy8uTDaXTU0xiSkXJLfPg8ZVfuBnSNETDQ+jtPgrD0ElkTV/DxOP6nP3LlaaPQ4Bz6vhbB3WcOGckxwhGQrGTcw1y/23BggVYv349BgdT4f2TJ0/ysjQf0ebbSC0zw6ix9k0aAVjp35W9c/fu3XjmmWeGHdz80tfR8NwToFK48FndXkTP9ODoay9Aj8egFjmmjQCcpcMuWSKGr1xan89egs+l4NUPYnivc3zjYCtXrsTOnTtz/Yndq6353QWcCQGd/SPT24Yrgnh/IDFjlptOTZv+NDVlpqk9EYECIYBgiruA6hJWVKkMBzvQfc4w1+C26UeCETErWbfAspQ5NFxdopCSRzJMzN0Hj+97HTOPAC+Rcepqf9q+nnXr1j2iadqaysrKVNPi8KDtXy34yxvPQXP5ksEVFln331iUGPsetCKfmlaEcHggUXKqphUUAWqo8psPxPG3wzoqvLZwMBAd1HHr+kdx97KbEQ6evaRz+/1+XH/99R/T5k/JSpDSpJWWCBy/1pmgeQE7kGMsYO3atTnHAl7+KjUMc6khGEo99KpGT4zPkZkRUQC4vELBk2/G8Jv3h48SNTc3o6GhYbyXmHlLxHioon3lKqIDOWp61sxTEREomPEicAYiOz6QCFoqQoAZDw5QcXiXM3TiacG9alL77iIhwIwHD+xwbH9nWzSRumWjt1vHxscfRceL36Pt1Dp/4XCY4/XbaPMP/O+XeFlOWe8UAuQBeECHZ/ke6TMtHWXzl+PG664G2DLBLvP7IgIFQgCBEEAgBBAIAQRCAIEQQCAEEOQDpiUQxOHUirRoGk+74lwBXihhNJNvOBRb7DITL+OXmHOpWEu2+QcMczFHRQgwHtgJIulhy3hVVVUt/fbw61AYkbgCh2ags78X8XgUwYjZAHEF8ARJzo9XlYsnBXGCEeebHunTL3ktXr4mJ6dw5o6mji8FXAgA/NCyDOzatauZbFhGxKJFi3D8+HHmSHIfZ9bsfsgBl2aur3MhLJyj4JW/xvBC2/im6nJ497WHnYnspOzFGUQDCIQAAiGAQDTA9MFOwmBxmC7SFpYrKHWNX7az4GTtUVtqLsjEsKeGnQ4as8IzmCgC8ITRlUi9lZOrq7+jo6OKX4bo9ZpL8TmcLsSiESyfG0FJkFy5ErMBYgF2WXlKndvgyud3771zSM9YdLlYiWHAcyVu+8Iq2r60JQhjIMGJIbz1yV76HabPRZanAszx0JdZoCbuZaYvpj5RBHgEOdLCt23bljMt/E+POXHtV9zJBZLtOEA/+eT8YkX7weM8+78f0fFU83C3YMuWDdi7Y8e4bjr15tAwzJkqJpZXK9i1UTVXCBECTDz4TVqcXdOfIy18lsZjZhcBDCNlAvECBLOtBRgMRhF0ASFLeceo3/eQql++0Jl8rQqjbo6CmtKp7xTicQMhfyShR+yxhgAvCTsoBJgQXFl/HerritEXMGeHet1F6Dk7gB+9+SGJQVb81hjBUBzOeUuw9fsbYUQGYM8b6+npwZo1a/h18K/DnCh5IeiWwnsYo0zP9niLcc1n6skd1Imc5jWvqHGj9uxJoO2oEGC8qFt9O8quno+ys9b72CuKETnQjRef/I/9DCaPbWhYhuYfPJ3rNHvJfjyGy941WgK4fKWouW0dPfLR1ApPl1ei5uN3aEMIMH4E/IDfDZwfsKIvYXNfvkAnAvrPZq4UycscDYVEBAqEAAIhgEAIIBACCIQAAiGAQOIAY76qmrL0z3lVMpwqrGZ+VhUhwISAszs4t9tpXZ63HXm0PiBXtL24pWoFglwOKi1NCDACmmC+sTLjpVFNTU2vNDY23mK/NMpJv6ORCDZtfgidRw6hpMxMAwr4z2HRkmXo6OiAw+lEJGzmaPMyK9XV1f+kzfvI5iKVLsAvpBxrTPYBsjlk1pKkCHg8nprW1taWSCTi1awFKudUVOKDfe+i/oubEhlM9v6e7l5suPcb6DzRhd6e7uRJeRn3pUuXPkubT5MtSac52YG8ZwAvFDmJ1mzkQF1dnWGRJGm8bwQ0T+L9+cgC2Rdsb28fdn9sDz744Ej3uGWSy3HSTESgeAECIYBA3MBJgi0KM3K3iwks6Hw+cxVxzs6lXdzPZo+3+tLOMVkIWtex79HQTOXnZfHqcDiS90ifObFkAMNf2R4tVAJM1GrhI8FjqWF7EjcXnjsUCn2s6/pCxZp5kRAjqnqCSMDzCzhRzJvWQkUnkQSKdS0VqWWqg3Rvn6N7bFXSZobQPjidzl+73e77rEpPb0UHC5UEU9ECZFfeAFV0rln9ukWQYS3GZDpBOVodJuNgSUlJruNjU3x/ogEEQgCBEEBQqBpgJPwXZuqv/TKdCuRX2JR1wUGy9EmDl2OmpQRPgRcgkC5AIAQQCAEEQgCBEEAgBBAIAQRCAIEQQJAP+L8AAwDMG/xeeGjcYQAAAABJRU5ErkJggg==" x="0" y="0" height="'+height+'px" width="'+width+'px"/><text text-anchor="middle" x="' + width/2 + '" y="' + height/2 + '" style="fill:#fff;font-weight:bold;font-size:' + font_size + 'px;font-family:Arial,Helvetica,sans-serif;dominant-baseline:central">' + width + 'x' + height + '</text></svg>');
});

var server = app.listen(port, function() {
    console.log('Listening on port %d', server.address().port);
});